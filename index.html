<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MedNow | Medicine & Lab Tests in 10 Minutes</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        mednow: {
                            blue: '#0288D1',  // Main Brand Blue
                            teal: '#00BCD4',  // Accent Teal
                            light: '#E1F5FE', // Light Background
                            dark: '#01579B',  // Dark Text/Footer
                            success: '#4CAF50'
                        }
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                    },
                    boxShadow: {
                        'soft': '0 4px 20px -2px rgba(0, 0, 0, 0.05)',
                        'card': '0 10px 30px -5px rgba(0, 188, 212, 0.15)',
                    },
                    animation: {
                        'shake': 'shake 0.5s cubic-bezier(.36,.07,.19,.97) both',
                        'bounce-slow': 'bounce 3s infinite',
                        'fade-in-up': 'fadeInUp 0.5s ease-out forwards',
                    },
                    keyframes: {
                        shake: {
                            '10%, 90%': { transform: 'translate3d(-1px, 0, 0)' },
                            '20%, 80%': { transform: 'translate3d(2px, 0, 0)' },
                            '30%, 50%, 70%': { transform: 'translate3d(-4px, 0, 0)' },
                            '40%, 60%': { transform: 'translate3d(4px, 0, 0)' }
                        },
                        fadeInUp: {
                            '0%': { opacity: '0', transform: 'translateY(10px)' },
                            '100%': { opacity: '1', transform: 'translateY(0)' }
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Inter', sans-serif; scroll-behavior: smooth; -webkit-tap-highlight-color: transparent; }
        
        .glass-effect {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
        }

        .upload-zone {
            background-image: url("data:image/svg+xml,%3csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100%25' height='100%25' fill='none' rx='16' ry='16' stroke='%23CBD5E1FF' stroke-width='2' stroke-dasharray='12%2c 12' stroke-dashoffset='0' stroke-linecap='square'/%3e%3c/svg%3e");
            transition: all 0.3s ease;
        }
        
        .upload-zone:hover {
            background-color: #F0FDFA;
            background-image: url("data:image/svg+xml,%3csvg width='100%25' height='100%25' xmlns='http://www.w3.org/2000/svg'%3e%3crect width='100%25' height='100%25' fill='none' rx='16' ry='16' stroke='%2300BCD4FF' stroke-width='2' stroke-dasharray='12%2c 12' stroke-dashoffset='0' stroke-linecap='square'/%3e%3c/svg%3e");
        }

        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .fade-in {
            animation: fadeIn 0.5s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Chat Widget Styles */
        .chat-message {
            max-width: 85%;
            margin-bottom: 10px;
            padding: 10px 14px;
            border-radius: 16px;
            font-size: 14px;
            line-height: 1.4;
        }
        .chat-user {
            background-color: #0288D1;
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 4px;
        }
        .chat-bot {
            background-color: #F1F5F9;
            color: #334155;
            align-self: flex-start;
            border-bottom-left-radius: 4px;
            border: 1px solid #E2E8F0;
        }
        .typing-dot {
            animation: typing 1.4s infinite ease-in-out both;
        }
        .typing-dot:nth-child(1) { animation-delay: -0.32s; }
        .typing-dot:nth-child(2) { animation-delay: -0.16s; }
        @keyframes typing {
            0%, 80%, 100% { transform: scale(0); }
            40% { transform: scale(1); }
        }
        
        /* Mobile Optimizations */
        @media (max-width: 640px) {
            .chat-box-mobile {
                width: 100% !important;
                height: 60vh !important;
                right: 0 !important;
                bottom: 0 !important;
                border-radius: 20px 20px 0 0 !important;
            }
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-800">

    <nav class="fixed w-full z-50 top-0 transition-all duration-300" id="navbar">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16 md:h-20">
                <div class="flex items-center gap-2 cursor-pointer" onclick="window.scrollTo(0,0)">
                    <img src="images/logo.jpeg" alt="MedNow Logo" class="h-10 w-10 rounded-lg shadow-md object-cover">
                    <div class="flex flex-col">
                        <span class="font-bold text-2xl text-mednow-blue leading-none">MedNow</span>
                        <span class="text-[10px] font-semibold text-mednow-teal uppercase tracking-widest">Express</span>
                    </div>
                </div>

                <div class="hidden md:flex items-center space-x-8">
                    <a href="#upload" class="text-slate-600 hover:text-mednow-blue font-medium transition">Upload Prescription</a>
                    <a href="#otc" class="text-slate-600 hover:text-mednow-blue font-medium transition">Medicines</a>
                    <a href="#lab-tests" class="text-slate-600 hover:text-mednow-blue font-medium transition">Lab Tests</a>
                    <a href="#smart-features" class="text-slate-600 hover:text-mednow-blue font-medium transition">Tech</a>
                </div>

                <div class="flex items-center gap-3 md:gap-4">
                    <div class="hidden lg:flex items-center bg-blue-50 text-mednow-blue px-3 py-1.5 rounded-full text-sm font-medium cursor-pointer hover:bg-blue-100 transition" id="location-btn">
                        <i data-lucide="map-pin" class="h-4 w-4 mr-1"></i>
                        <span id="location-text">Set Location</span>
                    </div>

                    <div class="relative cursor-pointer group" onclick="toggleCart()">
                        <div class="p-2 rounded-full hover:bg-slate-100 transition relative">
                            <i data-lucide="shopping-bag" class="h-6 w-6 text-slate-700 group-hover:text-mednow-blue"></i>
                            <span id="cart-count" class="absolute top-0 right-0 bg-red-500 text-white text-[10px] font-bold h-4 w-4 flex items-center justify-center rounded-full transform scale-0 transition-transform duration-200">0</span>
                        </div>
                    </div>

                    <!-- Authenticated User (Hidden by default) -->
                    <div id="auth-user" class="hidden items-center gap-2 cursor-pointer group relative">
                        <div class="h-9 w-9 bg-gradient-to-r from-mednow-blue to-mednow-teal rounded-full flex items-center justify-center text-white font-bold text-sm shadow-md">
                            JD
                        </div>
                        <div class="hidden md:block">
                            <p class="text-xs font-bold text-slate-700">John Doe</p>
                        </div>
                        <!-- Dropdown -->
                        <div class="absolute right-0 top-full mt-2 w-48 bg-white rounded-xl shadow-xl border border-slate-100 hidden group-hover:block p-2 z-50">
                            <a href="#" class="block px-4 py-2 text-sm text-slate-600 hover:bg-blue-50 hover:text-mednow-blue rounded-lg">Profile</a>
                            <a href="#" class="block px-4 py-2 text-sm text-slate-600 hover:bg-blue-50 hover:text-mednow-blue rounded-lg">My Orders</a>
                            <div class="border-t my-1"></div>
                            <button onclick="logout()" class="block w-full text-left px-4 py-2 text-sm text-red-500 hover:bg-red-50 rounded-lg">Logout</button>
                        </div>
                    </div>

                    <!-- Login Button (Visible by default) -->
                    <button id="login-nav-btn" onclick="toggleLoginModal()" class="hidden md:block bg-mednow-blue text-white px-5 py-2 rounded-lg font-medium hover:bg-mednow-dark transition shadow-lg shadow-blue-500/30">
                        Login
                    </button>
                    
                    <button class="md:hidden p-2 text-slate-600" onclick="toggleMobileMenu()">
                        <i data-lucide="menu" class="h-7 w-7"></i>
                    </button>
                </div>
            </div>
        </div>

        <div id="mobile-menu" class="md:hidden bg-white border-t hidden shadow-lg">
            <div class="px-4 pt-2 pb-6 space-y-2">
                <a href="#upload" class="block px-3 py-3 rounded-md text-base font-medium text-slate-700 hover:bg-blue-50 hover:text-mednow-blue" onclick="toggleMobileMenu()">Upload Prescription</a>
                <a href="#otc" class="block px-3 py-3 rounded-md text-base font-medium text-slate-700 hover:bg-blue-50 hover:text-mednow-blue" onclick="toggleMobileMenu()">Browse Medicines</a>
                <a href="#lab-tests" class="block px-3 py-3 rounded-md text-base font-medium text-slate-700 hover:bg-blue-50 hover:text-mednow-blue" onclick="toggleMobileMenu()">Lab Tests</a>
                <a href="#smart-features" class="block px-3 py-3 rounded-md text-base font-medium text-slate-700 hover:bg-blue-50 hover:text-mednow-blue" onclick="toggleMobileMenu()">Smart Features</a>
                <button onclick="toggleLoginModal(); toggleMobileMenu()" class="w-full mt-4 bg-mednow-blue text-white px-5 py-3 rounded-lg font-medium shadow-md">Login / Sign Up</button>
            </div>
        </div>
    </nav>

    <!-- Login/Signup Modal -->
    <div id="login-modal" class="fixed inset-0 z-[80] hidden flex items-center justify-center p-4">
        <!-- Backdrop -->
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm transition-opacity" onclick="toggleLoginModal()"></div>
        
        <!-- Modal Content -->
        <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full relative overflow-hidden animate-fade-in-up flex flex-col md:flex-row h-auto md:max-w-4xl">
            
            <!-- Left Banner (Hidden on mobile) -->
            <div class="hidden md:flex md:w-1/2 bg-gradient-to-br from-mednow-blue to-mednow-teal p-8 flex-col justify-between text-white relative overflow-hidden">
                <div class="absolute top-0 left-0 w-full h-full opacity-20">
                    <svg class="w-full h-full" viewBox="0 0 100 100" preserveAspectRatio="none"><path d="M0 100 C 20 0 50 0 100 100 Z" fill="white"></path></svg>
                </div>
                <div>
                    <h2 class="text-3xl font-bold mb-2">MedNow</h2>
                    <p class="text-blue-100">Your health, our priority.</p>
                </div>
                <div class="space-y-4 relative z-10">
                    <div class="flex items-center gap-3">
                        <div class="bg-white/20 p-2 rounded-full"><i data-lucide="truck" class="h-5 w-5"></i></div>
                        <p class="text-sm font-medium">10 Minute Delivery</p>
                    </div>
                    <div class="flex items-center gap-3">
                        <div class="bg-white/20 p-2 rounded-full"><i data-lucide="shield-check" class="h-5 w-5"></i></div>
                        <p class="text-sm font-medium">100% Genuine Medicines</p>
                    </div>
                    <div class="flex items-center gap-3">
                        <div class="bg-white/20 p-2 rounded-full"><i data-lucide="percent" class="h-5 w-5"></i></div>
                        <p class="text-sm font-medium">Extra 15% OFF on first order</p>
                    </div>
                </div>
            </div>

            <!-- Right Form Area -->
            <div class="w-full md:w-1/2 p-8 bg-white relative">
                <button onclick="toggleLoginModal()" class="absolute top-4 right-4 text-slate-400 hover:text-slate-600 transition"><i data-lucide="x" class="h-6 w-6"></i></button>
                
                <!-- Toggle Headers -->
                <div class="flex gap-6 mb-8 border-b border-slate-100">
                    <button onclick="switchAuthMode('login')" id="tab-login" class="pb-3 text-lg font-bold text-mednow-blue border-b-2 border-mednow-blue transition-colors">Login</button>
                    <button onclick="switchAuthMode('signup')" id="tab-signup" class="pb-3 text-lg font-bold text-slate-400 hover:text-slate-600 transition-colors">Sign Up</button>
                </div>

                <!-- Login Form -->
                <div id="form-login" class="space-y-5">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">Mobile Number / Email</label>
                        <div class="relative">
                            <i data-lucide="user" class="absolute left-3 top-3 h-5 w-5 text-slate-400"></i>
                            <input type="text" placeholder="Enter your mobile or email" class="w-full pl-10 pr-4 py-3 rounded-xl border border-slate-200 focus:border-mednow-blue focus:ring-1 focus:ring-mednow-blue outline-none transition">
                        </div>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">Password</label>
                        <div class="relative">
                            <i data-lucide="lock" class="absolute left-3 top-3 h-5 w-5 text-slate-400"></i>
                            <input type="password" placeholder="••••••••" class="w-full pl-10 pr-4 py-3 rounded-xl border border-slate-200 focus:border-mednow-blue focus:ring-1 focus:ring-mednow-blue outline-none transition">
                        </div>
                        <div class="text-right mt-1">
                            <a href="#" class="text-xs text-mednow-blue hover:underline">Forgot Password?</a>
                        </div>
                    </div>
                    <button onclick="performLogin()" class="w-full bg-mednow-blue text-white py-3 rounded-xl font-bold shadow-lg hover:bg-mednow-dark transition flex justify-center items-center gap-2">
                        Login securely
                    </button>
                </div>

                <!-- Signup Form (Hidden) -->
                <div id="form-signup" class="hidden space-y-5">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">Full Name</label>
                        <input type="text" placeholder="John Doe" class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-mednow-blue focus:ring-1 focus:ring-mednow-blue outline-none transition">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">Mobile Number</label>
                        <input type="tel" placeholder="+91 98765 43210" class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-mednow-blue focus:ring-1 focus:ring-mednow-blue outline-none transition">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">Create Password</label>
                        <input type="password" placeholder="••••••••" class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:border-mednow-blue focus:ring-1 focus:ring-mednow-blue outline-none transition">
                    </div>
                    <button onclick="performLogin()" class="w-full bg-mednow-blue text-white py-3 rounded-xl font-bold shadow-lg hover:bg-mednow-dark transition flex justify-center items-center gap-2">
                        Create Account
                    </button>
                </div>

                <div class="mt-6 text-center">
                    <p class="text-xs text-slate-400">By continuing, you agree to our <a href="#" class="text-mednow-blue hover:underline">Terms</a> and <a href="#" class="text-mednow-blue hover:underline">Privacy Policy</a>.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Rest of content starts here (Hero, etc.) -->
    <section class="relative pt-24 pb-12 lg:pt-32 lg:pb-24 overflow-hidden">
        <div class="absolute top-0 right-0 -z-10 w-1/2 h-full bg-gradient-to-l from-blue-50 to-transparent"></div>
        <div class="absolute top-20 right-20 -z-10 h-64 w-64 bg-mednow-teal/10 rounded-full blur-3xl"></div>

        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            
            <!-- Value Prop Grid -->
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8 md:mb-12">
                <div class="bg-white p-4 rounded-xl border border-slate-100 shadow-sm flex items-start gap-4 hover:shadow-md transition">
                    <div class="bg-blue-50 p-2.5 rounded-lg text-mednow-blue">
                        <i data-lucide="shield-check" class="h-6 w-6"></i>
                    </div>
                    <div>
                        <h3 class="font-bold text-slate-800 text-sm md:text-base">100% Safe & Secure</h3>
                        <p class="text-xs text-slate-500 mt-1">We ensure secure payments and safe delivery.</p>
                    </div>
                </div>
                <div class="bg-white p-4 rounded-xl border border-slate-100 shadow-sm flex items-start gap-4 hover:shadow-md transition">
                    <div class="bg-green-50 p-2.5 rounded-lg text-green-600">
                        <i data-lucide="truck" class="h-6 w-6"></i>
                    </div>
                    <div>
                        <h3 class="font-bold text-slate-800 text-sm md:text-base">Fast Delivery</h3>
                        <p class="text-xs text-slate-500 mt-1">Get your medicines delivered within 24-48 hours.</p>
                    </div>
                </div>
                <div class="bg-white p-4 rounded-xl border border-slate-100 shadow-sm flex items-start gap-4 hover:shadow-md transition">
                    <div class="bg-orange-50 p-2.5 rounded-lg text-orange-500">
                        <i data-lucide="tag" class="h-6 w-6"></i>
                    </div>
                    <div>
                        <h3 class="font-bold text-slate-800 text-sm md:text-base">Best Prices</h3>
                        <p class="text-xs text-slate-500 mt-1">Save up to 20% on medicines and 50% on lab tests.</p>
                    </div>
                </div>
            </div>

            <div class="flex flex-col lg:flex-row items-center gap-8 lg:gap-20">
                
                <div class="lg:w-1/2 text-center lg:text-left space-y-6">
                    <div class="inline-flex items-center gap-2 bg-green-100 text-green-800 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wide animate-pulse">
                        <span class="w-2 h-2 bg-green-500 rounded-full"></span> Live in your area
                    </div>
                    
                    <h1 class="text-4xl md:text-5xl lg:text-6xl font-extrabold text-slate-900 leading-tight">
                        Medicines delivered <br>
                        in <span class="text-mednow-teal">10 minutes.</span>
                    </h1>
                    
                    <p class="text-lg text-slate-500 max-w-xl mx-auto lg:mx-0">
                        Skip the pharmacy queue. Upload your prescription or search below to get meds instantly.
                    </p>

                    <div class="relative max-w-md mx-auto lg:mx-0 w-full">
                        <input type="text" id="hero-search" placeholder="Search e.g. 'Dolo', 'Vitamin C'..." class="w-full pl-12 pr-20 py-4 rounded-xl border-2 border-slate-100 focus:border-mednow-teal focus:ring-0 shadow-sm transition bg-white">
                        <i data-lucide="search" class="absolute left-4 top-4 text-slate-400 h-6 w-6"></i>
                        <button onclick="scrollToStore()" class="absolute right-2 top-2 bg-mednow-blue text-white px-4 py-2 rounded-lg font-medium hover:bg-mednow-dark transition">
                            Find
                        </button>
                    </div>
                    
                    <div class="pt-4 flex flex-wrap items-center justify-center lg:justify-start gap-4 md:gap-6 text-sm text-slate-500 font-medium">
                        <div class="flex items-center gap-1"><i data-lucide="shield-check" class="text-mednow-teal h-4 w-4"></i> 100% Genuine</div>
                        <div class="flex items-center gap-1"><i data-lucide="clock" class="text-mednow-teal h-4 w-4"></i> 24/7 Service</div>
                    </div>
                </div>

                <div class="lg:w-1/2 w-full" id="upload">
                    <div class="bg-white rounded-2xl shadow-card p-6 md:p-8 border border-slate-100 relative overflow-hidden">
                        <div class="absolute top-0 left-0 w-full h-1.5 bg-gradient-to-r from-mednow-blue to-mednow-teal"></div>
                        
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <div class="flex items-center gap-2">
                                    <h2 class="text-xl font-bold text-slate-800">Order via Prescription</h2>
                                    <button id="preview-btn" onclick="togglePreview()" class="hidden p-1.5 bg-blue-50 text-mednow-blue rounded-full hover:bg-blue-100 transition group relative" title="View Uploaded Prescription">
                                        <i data-lucide="eye" class="h-4 w-4"></i>
                                        <span class="absolute -top-1 -right-1 h-2 w-2 bg-green-500 rounded-full border border-white"></span>
                                    </button>
                                </div>
                                <p class="text-sm text-slate-500 mt-1">Upload doctor's note. We'll verify & call.</p>
                            </div>
                            <div class="bg-blue-50 p-2 rounded-lg">
                                <i data-lucide="file-text" class="text-mednow-blue h-6 w-6"></i>
                            </div>
                        </div>

                        <div class="text-right mb-3">
                            <button onclick="toggleGuidelines()" class="text-xs text-mednow-blue hover:underline font-semibold flex items-center justify-end gap-1 w-full transition">
                                <i data-lucide="info" class="h-3 w-3"></i> What is a valid prescription?
                            </button>
                        </div>

                        <div class="upload-zone rounded-2xl p-8 flex flex-col items-center justify-center text-center cursor-pointer group relative overflow-hidden" id="drop-zone">
                            <div id="upload-default" class="transition-opacity duration-300">
                                <div class="bg-white p-3 rounded-full shadow-sm mb-3 group-hover:scale-110 transition-transform duration-300 inline-block">
                                    <i data-lucide="upload-cloud" class="h-8 w-8 text-mednow-teal"></i>
                                </div>
                                <p class="font-semibold text-slate-700">Click to Upload</p>
                                <p class="text-xs text-slate-400 mt-1">JPG, PNG, PDF</p>
                            </div>
                            
                            <div id="upload-loading" class="hidden absolute inset-0 flex flex-col items-center justify-center bg-white/90 backdrop-blur-sm z-10 rounded-2xl">
                                <div class="w-10 h-10 border-4 border-mednow-blue border-t-transparent rounded-full animate-spin mb-3"></div>
                                <p class="text-sm font-bold text-mednow-blue">Scanning...</p>
                            </div>

                            <div id="upload-success" class="hidden absolute inset-0 flex flex-col items-center justify-center bg-green-50 z-10 rounded-2xl">
                                <div class="w-12 h-12 bg-green-100 text-green-600 rounded-full flex items-center justify-center mb-2 animate-bounce">
                                    <i data-lucide="check" class="h-6 w-6"></i>
                                </div>
                                <p class="font-bold text-green-700">Image Verified!</p>
                                <p class="text-xs text-green-600 mt-1">Click submit below.</p>
                            </div>
                            
                            <input type="file" id="file-input" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer" accept="image/*,.pdf">
                        </div>

                        <div id="rx-error" class="hidden bg-red-50 border border-red-100 text-red-600 text-xs font-medium p-3 rounded-lg mt-3 flex items-center gap-2">
                            <i data-lucide="alert-circle" class="h-4 w-4 flex-shrink-0"></i>
                            <span>Please upload a prescription image first.</span>
                        </div>

                        <div class="mt-6">
                            <button onclick="submitPrescription()" id="submit-rx-btn" class="w-full bg-gradient-to-r from-mednow-blue to-mednow-teal text-white font-bold py-4 rounded-xl shadow-lg hover:shadow-xl hover:translate-y-[-2px] transition-all duration-300 flex items-center justify-center gap-2">
                                <span>Submit Prescription</span>
                                <i data-lucide="arrow-right" class="h-4 w-4"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ... (All Sections: OTC, Lab Tests, Smart Features, Footer, Modals) - No changes needed except appending JS ... -->
    <section id="otc" class="py-16 bg-slate-50 min-h-screen">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col md:flex-row justify-between items-end mb-8 gap-4">
                <div>
                    <h2 class="text-2xl md:text-3xl font-bold text-slate-900">Wellness Essentials</h2>
                    <p class="text-slate-500 mt-2">Select a category or search above.</p>
                </div>
                <div id="active-filter-display" class="text-sm font-medium text-mednow-blue hidden">
                    Showing results for: <span id="filter-term" class="font-bold"></span>
                </div>
            </div>

            <div class="flex gap-3 overflow-x-auto no-scrollbar mb-8 pb-2 px-1" id="category-container">
                <button onclick="filterCategory('all')" class="category-btn active px-5 py-2 bg-mednow-blue text-white rounded-full text-sm font-medium shadow-md whitespace-nowrap transition-colors" data-cat="all">All Products</button>
                <button onclick="filterCategory('pain')" class="category-btn px-5 py-2 bg-white text-slate-600 border border-slate-200 rounded-full text-sm font-medium hover:bg-blue-50 whitespace-nowrap transition-colors" data-cat="pain">Pain Relief</button>
                <button onclick="filterCategory('vitamins')" class="category-btn px-5 py-2 bg-white text-slate-600 border border-slate-200 rounded-full text-sm font-medium hover:bg-blue-50 whitespace-nowrap transition-colors" data-cat="vitamins">Vitamins</button>
                <button onclick="filterCategory('diabetes')" class="category-btn px-5 py-2 bg-white text-slate-600 border border-slate-200 rounded-full text-sm font-medium hover:bg-blue-50 whitespace-nowrap transition-colors" data-cat="diabetes">Diabetes Care</button>
                <button onclick="filterCategory('first_aid')" class="category-btn px-5 py-2 bg-white text-slate-600 border border-slate-200 rounded-full text-sm font-medium hover:bg-blue-50 whitespace-nowrap transition-colors" data-cat="first_aid">First Aid</button>
            </div>

            <!-- Mobile: 2 columns with smaller gap. Desktop: 4/5 columns -->
            <div id="products-grid" class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3 md:gap-6">
                <!-- Content injected by JS -->
            </div>
            
            <div id="no-results" class="hidden text-center py-20">
                <div class="inline-block p-4 rounded-full bg-slate-100 mb-4">
                    <i data-lucide="search-x" class="h-10 w-10 text-slate-400"></i>
                </div>
                <h3 class="text-lg font-semibold text-slate-700">No medicines found</h3>
                <p class="text-slate-500">Try a different keyword or browse categories.</p>
                <button onclick="filterCategory('all')" class="mt-4 text-mednow-blue font-medium hover:underline">Reset Search</button>
            </div>
        </div>
    </section>

    <!-- Lab Tests Section -->
    <section id="lab-tests" class="py-16 bg-white border-t border-slate-100">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold text-slate-900">Diagnostic Tests</h2>
                <p class="text-slate-500 mt-2">Trusted Labs. Accurate Reports. Home Collection.</p>
                <div class="flex flex-wrap justify-center gap-3 mt-4 text-sm font-medium text-mednow-teal">
                    <span class="bg-blue-50 px-3 py-1 rounded-full flex items-center gap-1 border border-blue-100"><i data-lucide="shield-check" class="h-4 w-4"></i> 100% Safe</span>
                    <span class="bg-blue-50 px-3 py-1 rounded-full flex items-center gap-1 border border-blue-100"><i data-lucide="award" class="h-4 w-4"></i> NABL Certified</span>
                    <span class="bg-blue-50 px-3 py-1 rounded-full flex items-center gap-1 border border-blue-100"><i data-lucide="star" class="h-4 w-4"></i> 4.8/5 Rated</span>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <!-- Package 1 -->
                <div class="border border-slate-200 rounded-2xl p-6 hover:shadow-card transition relative overflow-hidden group bg-white">
                    <div class="absolute top-0 right-0 bg-red-500 text-white text-xs font-bold px-3 py-1 rounded-bl-lg">50% OFF</div>
                    <h3 class="text-xl font-bold text-slate-800">Comprehensive Full Body Checkup</h3>
                    <p class="text-slate-500 text-sm mt-1 font-medium bg-slate-100 inline-block px-2 py-0.5 rounded">80+ Tests</p>
                    <p class="text-xs text-slate-500 mt-3 h-10">Includes Thyroid, Liver, Kidney, Lipid Profile, and more.</p>
                    
                    <div class="my-4 flex items-baseline gap-2">
                        <span class="text-2xl font-bold text-slate-900">₹1499</span>
                        <span class="text-sm text-slate-400 line-through">₹2999</span>
                    </div>

                    <ul class="space-y-2 text-xs text-slate-600 mb-6">
                        <li class="flex gap-2 items-center"><div class="w-1.5 h-1.5 rounded-full bg-green-500"></div> E-Reports in 24 hours</li>
                        <li class="flex gap-2 items-center"><div class="w-1.5 h-1.5 rounded-full bg-green-500"></div> Free Home Sample Collection</li>
                    </ul>

                    <button onclick="bookLabTest('Full Body Checkup', 1499)" class="w-full bg-mednow-blue text-white py-3 rounded-xl font-bold hover:bg-mednow-dark transition shadow-md flex items-center justify-center gap-2">
                        Book Now <i data-lucide="chevron-right" class="h-4 w-4"></i>
                    </button>
                </div>

                <!-- Package 2 -->
                <div class="border border-slate-200 rounded-2xl p-6 hover:shadow-card transition relative overflow-hidden group bg-white">
                    <div class="absolute top-0 right-0 bg-mednow-teal text-white text-xs font-bold px-3 py-1 rounded-bl-lg">37% OFF</div>
                    <h3 class="text-xl font-bold text-slate-800">Thyroid Profile Total</h3>
                    <p class="text-slate-500 text-sm mt-1 font-medium bg-slate-100 inline-block px-2 py-0.5 rounded">3 Tests</p>
                    <p class="text-xs text-slate-500 mt-3 h-10">T3, T4, TSH tests for comprehensive thyroid function analysis.</p>
                    
                    <div class="my-4 flex items-baseline gap-2">
                        <span class="text-2xl font-bold text-slate-900">₹499</span>
                        <span class="text-sm text-slate-400 line-through">₹800</span>
                    </div>

                    <ul class="space-y-2 text-xs text-slate-600 mb-6">
                        <li class="flex gap-2 items-center"><div class="w-1.5 h-1.5 rounded-full bg-green-500"></div> E-Reports in 24 hours</li>
                        <li class="flex gap-2 items-center"><div class="w-1.5 h-1.5 rounded-full bg-green-500"></div> Free Home Sample Collection</li>
                    </ul>

                    <button onclick="bookLabTest('Thyroid Profile', 499)" class="w-full bg-white text-mednow-blue border-2 border-mednow-blue py-3 rounded-xl font-bold hover:bg-blue-50 transition shadow-sm flex items-center justify-center gap-2">
                        Book Now <i data-lucide="chevron-right" class="h-4 w-4"></i>
                    </button>
                </div>

                <!-- Package 3 -->
                <div class="border border-slate-200 rounded-2xl p-6 hover:shadow-card transition relative overflow-hidden group bg-white">
                    <div class="absolute top-0 right-0 bg-mednow-teal text-white text-xs font-bold px-3 py-1 rounded-bl-lg">40% OFF</div>
                    <h3 class="text-xl font-bold text-slate-800">Diabetes Screening</h3>
                    <p class="text-slate-500 text-sm mt-1 font-medium bg-slate-100 inline-block px-2 py-0.5 rounded">2 Tests</p>
                    <p class="text-xs text-slate-500 mt-3 h-10">HbA1c and Fasting Blood Sugar for accurate diabetes screening.</p>
                    
                    <div class="my-4 flex items-baseline gap-2">
                        <span class="text-2xl font-bold text-slate-900">₹299</span>
                        <span class="text-sm text-slate-400 line-through">₹500</span>
                    </div>

                    <ul class="space-y-2 text-xs text-slate-600 mb-6">
                        <li class="flex gap-2 items-center"><div class="w-1.5 h-1.5 rounded-full bg-green-500"></div> E-Reports in 24 hours</li>
                        <li class="flex gap-2 items-center"><div class="w-1.5 h-1.5 rounded-full bg-green-500"></div> Free Home Sample Collection</li>
                    </ul>

                    <button onclick="bookLabTest('Diabetes Screening', 299)" class="w-full bg-white text-mednow-blue border-2 border-mednow-blue py-3 rounded-xl font-bold hover:bg-blue-50 transition shadow-sm flex items-center justify-center gap-2">
                        Book Now <i data-lucide="chevron-right" class="h-4 w-4"></i>
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- NEW Smart Features Section -->
    <section id="smart-features" class="py-20 bg-slate-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="text-center mb-12">
                <h2 class="text-3xl font-bold text-slate-900">Smart Healthcare Technology</h2>
                <p class="text-slate-500 mt-2 max-w-2xl mx-auto">Leveraging AI and advanced logistics to deliver the fastest, safest care.</p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- Feature 1 -->
                <div class="bg-white p-6 rounded-2xl border border-slate-100 shadow-sm hover:shadow-card transition group">
                    <div class="w-12 h-12 bg-blue-100 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition text-mednow-blue">
                        <i data-lucide="map-pin" class="h-6 w-6"></i>
                    </div>
                    <h3 class="font-bold text-slate-800 text-lg">AI-Based Pharmacy Finder</h3>
                    <p class="text-sm text-slate-500 mt-2 leading-relaxed">Automatically detects the closest pharmacy to deliver medicines fast and efficiently.</p>
                </div>

                <!-- Feature 2 -->
                <div class="bg-white p-6 rounded-2xl border border-slate-100 shadow-sm hover:shadow-card transition group">
                    <div class="w-12 h-12 bg-purple-100 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition text-purple-600">
                        <i data-lucide="file-check" class="h-6 w-6"></i>
                    </div>
                    <h3 class="font-bold text-slate-800 text-lg">Smart Verification</h3>
                    <p class="text-sm text-slate-500 mt-2 leading-relaxed">Verified by AI + Doctor for accuracy, safety and faster order processing.</p>
                </div>

                <!-- Feature 3 -->
                <div class="bg-white p-6 rounded-2xl border border-slate-100 shadow-sm hover:shadow-card transition group">
                    <div class="w-12 h-12 bg-red-100 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition text-red-600">
                        <i data-lucide="zap" class="h-6 w-6"></i>
                    </div>
                    <h3 class="font-bold text-slate-800 text-lg">Emergency Priority Mode</h3>
                    <p class="text-sm text-slate-500 mt-2 leading-relaxed">Urgent cases like heart, asthma or diabetes get high-priority dispatch with 5–10 minute delivery.</p>
                </div>

                <!-- Feature 4 -->
                <div class="bg-white p-6 rounded-2xl border border-slate-100 shadow-sm hover:shadow-card transition group">
                    <div class="w-12 h-12 bg-cyan-100 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition text-cyan-600">
                        <i data-lucide="thermometer" class="h-6 w-6"></i>
                    </div>
                    <h3 class="font-bold text-slate-800 text-lg">Live Cold-Chain Monitoring</h3>
                    <p class="text-sm text-slate-500 mt-2 leading-relaxed">Smart temperature-controlled rider box for sensitive medicines. Ensures quality & freshness.</p>
                </div>

                <!-- Feature 5 -->
                <div class="bg-white p-6 rounded-2xl border border-slate-100 shadow-sm hover:shadow-card transition group">
                    <div class="w-12 h-12 bg-orange-100 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition text-orange-600">
                        <i data-lucide="box" class="h-6 w-6"></i>
                    </div>
                    <h3 class="font-bold text-slate-800 text-lg">Smart Inventory System</h3>
                    <p class="text-sm text-slate-500 mt-2 leading-relaxed">Connected pharmacies update stock in real time — no more Out of Stock issues.</p>
                </div>

                <!-- Feature 6 -->
                <div class="bg-white p-6 rounded-2xl border border-slate-100 shadow-sm hover:shadow-card transition group">
                    <div class="w-12 h-12 bg-green-100 rounded-xl flex items-center justify-center mb-4 group-hover:scale-110 transition text-green-600">
                        <i data-lucide="bell" class="h-6 w-6"></i>
                    </div>
                    <h3 class="font-bold text-slate-800 text-lg">Predictive Refill Reminders</h3>
                    <p class="text-sm text-slate-500 mt-2 leading-relaxed">Automatic reminders for regular medicines like BP, Diabetes. Never run out again.</p>
                </div>
            </div>
        </div>
    </section>

    <section id="features" class="py-12 bg-mednow-blue text-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex flex-col md:flex-row justify-between items-center gap-8 text-center md:text-left">
                <div>
                    <h2 class="text-2xl font-bold">Why choose MedNow?</h2>
                    <p class="text-blue-100 mt-2 max-w-md">We combine speed with safety to ensure your health is never compromised.</p>
                </div>
                <div class="flex flex-wrap justify-center gap-6">
                    <div class="bg-white/10 backdrop-blur-md p-4 rounded-xl border border-white/20 w-32">
                        <h4 class="font-bold text-2xl text-mednow-teal">10m</h4>
                        <p class="text-xs text-blue-100">Delivery</p>
                    </div>
                    <div class="bg-white/10 backdrop-blur-md p-4 rounded-xl border border-white/20 w-32">
                        <h4 class="font-bold text-2xl text-mednow-teal">10k+</h4>
                        <p class="text-xs text-blue-100">Products</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Updated Footer -->
    <footer class="bg-slate-900 text-slate-300 pt-16 pb-8 border-t border-slate-800" id="contact">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-12 mb-12">
                
                <!-- Brand & Description -->
                <div class="space-y-4">
                    <div class="flex items-center gap-2">
                        <span class="font-bold text-2xl text-white">MedNow</span>
                    </div>
                    <p class="text-sm text-slate-400 leading-relaxed">
                        Experience the fastest healthcare delivery in India. Medicines in 10 minutes, Lab Tests from home.
                    </p>
                    <div class="flex flex-col sm:flex-row gap-3 pt-2">
                        <button class="bg-slate-800 hover:bg-slate-700 border border-slate-700 text-white py-2 px-4 rounded-lg flex items-center gap-2 transition w-fit">
                            <i data-lucide="apple" class="h-5 w-5"></i>
                            <div class="text-left">
                                <p class="text-[10px] leading-none text-slate-400">Download on the</p>
                                <p class="text-xs font-bold leading-none mt-0.5">App Store</p>
                            </div>
                        </button>
                        <button class="bg-slate-800 hover:bg-slate-700 border border-slate-700 text-white py-2 px-4 rounded-lg flex items-center gap-2 transition w-fit">
                            <i data-lucide="play" class="h-5 w-5"></i>
                            <div class="text-left">
                                <p class="text-[10px] leading-none text-slate-400">GET IT ON</p>
                                <p class="text-xs font-bold leading-none mt-0.5">Google Play</p>
                            </div>
                        </button>
                    </div>
                </div>

                <!-- Services -->
                <div>
                    <h3 class="text-white font-bold mb-6">Services</h3>
                    <ul class="space-y-4 text-sm">
                        <li><a href="#otc" class="hover:text-mednow-teal transition flex items-center gap-2"><i data-lucide="chevron-right" class="h-3 w-3 text-slate-600"></i> Order Medicine</a></li>
                        <li><a href="#lab-tests" class="hover:text-mednow-teal transition flex items-center gap-2"><i data-lucide="chevron-right" class="h-3 w-3 text-slate-600"></i> Book Lab Tests</a></li>
                        <li><a href="#" class="hover:text-mednow-teal transition flex items-center gap-2"><i data-lucide="chevron-right" class="h-3 w-3 text-slate-600"></i> Consult a Doctor</a></li>
                    </ul>
                </div>

                <!-- Company -->
                <div>
                    <h3 class="text-white font-bold mb-6">Company</h3>
                    <ul class="space-y-4 text-sm">
                        <li><a href="#" class="hover:text-mednow-teal transition">About Us</a></li>
                        <li><a href="#" class="hover:text-mednow-teal transition">Careers</a></li>
                        <li><a href="#" class="hover:text-mednow-teal transition">Blog</a></li>
                        <li><a href="#" class="hover:text-mednow-teal transition">Partner with MedNow</a></li>
                    </ul>
                </div>

                <!-- Contact -->
                <div>
                    <h3 class="text-white font-bold mb-6">Contact</h3>
                    <ul class="space-y-4 text-sm">
                        <li class="flex items-start gap-3">
                            <i data-lucide="phone" class="h-5 w-5 text-mednow-teal mt-0.5"></i>
                            <span>+91 8600175623</span>
                        </li>
                        <li class="flex items-start gap-3">
                            <i data-lucide="mail" class="h-5 w-5 text-mednow-teal mt-0.5"></i>
                            <a href="mailto:help@mednow.com" class="hover:text-white transition">help@mednow.com</a>
                        </li>
                    </ul>
                    <div class="flex gap-4 mt-6">
                        <a href="#" class="bg-slate-800 p-2 rounded-full hover:bg-mednow-blue hover:text-white transition"><i data-lucide="instagram" class="h-4 w-4"></i></a>
                        <a href="#" class="bg-slate-800 p-2 rounded-full hover:bg-mednow-blue hover:text-white transition"><i data-lucide="twitter" class="h-4 w-4"></i></a>
                        <a href="#" class="bg-slate-800 p-2 rounded-full hover:bg-mednow-blue hover:text-white transition"><i data-lucide="facebook" class="h-4 w-4"></i></a>
                    </div>
                </div>
            </div>

            <!-- Bottom Bar -->
            <div class="border-t border-slate-800 pt-8 flex flex-col md:flex-row justify-between items-center gap-4 text-xs text-slate-500">
                <p>&copy; 2025 MedNow. All Rights Reserved.</p>
                <div class="flex gap-6">
                    <a href="#" class="hover:text-slate-300 transition">Privacy Policy</a>
                    <a href="#" class="hover:text-slate-300 transition">Terms of Service</a>
                </div>
            </div>
        </div>
    </footer>

    <!-- --- MODALS --- -->
    <div id="guidelines-modal" class="fixed inset-0 z-[70] hidden flex items-center justify-center">
        <div class="absolute inset-0 bg-black/60 backdrop-blur-sm" onclick="toggleGuidelines()"></div>
        <div class="bg-white rounded-2xl shadow-2xl max-w-sm w-full m-4 relative overflow-hidden animate-shake">
            <div class="bg-mednow-blue p-4 flex justify-between items-center">
                <h3 class="text-white font-bold text-lg">Prescription Guidelines</h3>
                <button onclick="toggleGuidelines()" class="text-white/80 hover:text-white"><i data-lucide="x" class="h-5 w-5"></i></button>
            </div>
            <div class="p-6 space-y-5">
                <div>
                    <h4 class="font-bold text-slate-900 mb-2 text-sm uppercase tracking-wide text-mednow-blue">A Valid Prescription Contains:</h4>
                    <ul class="space-y-2 text-sm text-slate-600">
                        <li class="flex items-center gap-2"><i data-lucide="check-circle-2" class="h-4 w-4 text-green-500"></i> Doctor Details</li>
                        <li class="flex items-center gap-2"><i data-lucide="check-circle-2" class="h-4 w-4 text-green-500"></i> Date of Prescription</li>
                        <li class="flex items-center gap-2"><i data-lucide="check-circle-2" class="h-4 w-4 text-green-500"></i> Patient Details</li>
                        <li class="flex items-center gap-2"><i data-lucide="check-circle-2" class="h-4 w-4 text-green-500"></i> Dosage Details</li>
                    </ul>
                </div>
                <div class="border-t border-slate-100 pt-4">
                    <h4 class="font-bold text-slate-900 mb-2 text-sm uppercase tracking-wide text-mednow-blue">Do’s and Don’ts</h4>
                    <div class="space-y-3 text-sm">
                        <div class="flex gap-2">
                            <i data-lucide="thumbs-up" class="h-4 w-4 text-green-600 mt-0.5"></i>
                            <p class="text-slate-600"><strong class="text-green-600">Upload Clear Image:</strong> Ensure visible handwriting. Place on flat surface.</p>
                        </div>
                        <div class="flex gap-2">
                            <i data-lucide="thumbs-down" class="h-4 w-4 text-red-500 mt-0.5"></i>
                            <p class="text-slate-600"><strong class="text-red-500">No Pictures of Medicines:</strong> Only prescription paper allowed.</p>
                        </div>
                        <div class="flex gap-2">
                            <i data-lucide="thumbs-down" class="h-4 w-4 text-red-500 mt-0.5"></i>
                            <p class="text-slate-600"><strong class="text-red-500">Do Not Crop:</strong> Keep full page visible.</p>
                        </div>
                    </div>
                </div>
            </div>
            <div class="bg-slate-50 p-4 text-center">
                <button onclick="toggleGuidelines()" class="text-mednow-blue font-bold text-sm hover:underline">Got it</button>
            </div>
        </div>
    </div>

    <div id="preview-modal" class="fixed inset-0 z-[70] hidden flex items-center justify-center">
        <div class="absolute inset-0 bg-black/80 backdrop-blur-sm" onclick="togglePreview()"></div>
        <div class="bg-white rounded-xl p-2 max-w-lg w-full m-4 relative shadow-2xl flex flex-col max-h-[90vh]">
            <button onclick="togglePreview()" class="absolute -top-10 right-0 text-white hover:text-slate-200"><i data-lucide="x" class="h-8 w-8"></i></button>
            
            <div class="relative flex-1 overflow-hidden bg-slate-100 rounded-t-lg">
                <img id="preview-image" src="" alt="Uploaded Prescription" class="w-full h-full object-contain">
            </div>
            
            <div class="p-4 bg-white rounded-b-lg space-y-3">
                <div class="flex justify-between items-center">
                    <p class="text-sm font-bold text-slate-700">Prescription Preview</p>
                    <button onclick="document.getElementById('file-input').click(); togglePreview()" class="text-xs text-mednow-blue hover:underline">Change Image</button>
                </div>
                
                <div class="border-t border-slate-100 pt-3">
                    <div id="ai-scan-results" class="hidden mb-3 p-3 bg-purple-50 rounded-lg border border-purple-100 text-sm text-slate-700 max-h-32 overflow-y-auto">
                        <!-- Results go here -->
                    </div>
                    
                    <button onclick="analyzePrescription()" id="ai-scan-btn" class="w-full bg-gradient-to-r from-purple-600 to-indigo-600 text-white py-2.5 rounded-lg font-bold shadow-md hover:shadow-lg transition flex items-center justify-center gap-2">
                        <i data-lucide="sparkles" class="h-4 w-4"></i> ✨ Scan Medicines with AI
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div id="cart-modal" class="fixed inset-0 z-[60] hidden">
        <div class="absolute inset-0 bg-black/50 backdrop-blur-sm transition-opacity opacity-0" id="cart-backdrop" onclick="toggleCart()"></div>
        
        <div class="absolute right-0 top-0 h-full w-full max-w-md bg-white shadow-2xl transform transition-transform duration-300 translate-x-full flex flex-col" id="cart-panel">
            
            <div class="p-5 border-b flex justify-between items-center bg-slate-50">
                <h2 class="text-xl font-bold text-slate-800 flex items-center gap-2">
                    <i data-lucide="shopping-cart" class="text-mednow-blue"></i> Your Cart
                </h2>
                <button onclick="toggleCart()" class="p-2 hover:bg-slate-200 rounded-full text-slate-500 transition">
                    <i data-lucide="x" class="h-6 w-6"></i>
                </button>
            </div>

            <div class="flex-1 overflow-hidden relative">
                
                <div id="cart-view" class="h-full flex flex-col transition-transform duration-300">
                    <div id="cart-items-container" class="flex-1 overflow-y-auto p-5 space-y-4">
                        <div class="flex flex-col items-center justify-center h-full text-slate-400">
                            <i data-lucide="shopping-basket" class="h-16 w-16 mb-4 opacity-50"></i>
                            <p>Your cart is empty</p>
                            <button onclick="toggleCart(); scrollToStore()" class="mt-4 text-mednow-blue font-bold hover:underline">Start Shopping</button>
                        </div>
                    </div>
                    
                    <div class="p-5 border-t bg-slate-50 shadow-[0_-4px_20px_rgba(0,0,0,0.05)]">
                        <div class="flex justify-between items-center mb-4 text-lg">
                            <span class="text-slate-500 font-medium">Total Amount</span>
                            <span class="text-2xl font-bold text-slate-900" id="cart-total">₹0</span>
                        </div>
                        <button onclick="showPayment()" id="checkout-btn" class="w-full bg-mednow-blue text-white py-4 rounded-xl font-bold shadow-lg hover:bg-mednow-dark transition flex justify-center items-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
                            Proceed to Payment <i data-lucide="arrow-right" class="h-4 w-4"></i>
                        </button>
                    </div>
                </div>

                <div id="payment-view" class="absolute inset-0 bg-white transform translate-x-full transition-transform duration-300 flex flex-col h-full z-10">
                    <div class="p-5 border-b flex items-center gap-3 bg-slate-50">
                        <button onclick="hidePayment()" class="text-slate-500 hover:text-mednow-blue"><i data-lucide="arrow-left"></i></button>
                        <h3 class="font-bold text-lg">Payment Method</h3>
                    </div>
                    
                    <div class="flex-1 p-6 space-y-4 overflow-y-auto">
                        <div class="text-xs text-slate-500 mb-2 uppercase font-bold tracking-wide">Select Option</div>
                        
                        <label class="flex items-center gap-4 p-4 border rounded-xl cursor-pointer hover:border-mednow-blue hover:bg-blue-50 transition group shadow-sm">
                            <input type="radio" name="payment" value="upi" class="h-5 w-5 text-mednow-blue border-slate-300 focus:ring-mednow-blue" checked>
                            <div class="flex-1">
                                <div class="font-bold text-slate-800">UPI / GPay / PhonePe</div>
                                <div class="text-xs text-slate-500">Pay instantly from your phone</div>
                            </div>
                            <i data-lucide="smartphone" class="text-slate-400 group-hover:text-mednow-blue"></i>
                        </label>

                        <label class="flex items-center gap-4 p-4 border rounded-xl cursor-pointer hover:border-mednow-blue hover:bg-blue-50 transition group shadow-sm">
                            <input type="radio" name="payment" value="card" class="h-5 w-5 text-mednow-blue border-slate-300 focus:ring-mednow-blue">
                            <div class="flex-1">
                                <div class="font-bold text-slate-800">Credit / Debit Card</div>
                                <div class="text-xs text-slate-500">Visa, Mastercard, Rupay</div>
                            </div>
                            <i data-lucide="credit-card" class="text-slate-400 group-hover:text-mednow-blue"></i>
                        </label>

                        <label class="flex items-center gap-4 p-4 border rounded-xl cursor-pointer hover:border-mednow-blue hover:bg-blue-50 transition group shadow-sm">
                            <input type="radio" name="payment" value="cod" class="h-5 w-5 text-mednow-blue border-slate-300 focus:ring-mednow-blue">
                            <div class="flex-1">
                                <div class="font-bold text-slate-800">Cash on Delivery</div>
                                <div class="text-xs text-slate-500">Pay cash upon arrival</div>
                            </div>
                            <i data-lucide="banknote" class="text-slate-400 group-hover:text-mednow-blue"></i>
                        </label>
                        
                        <div class="mt-8 bg-blue-50 p-4 rounded-lg border border-blue-100">
                            <p class="text-xs text-mednow-blue flex items-center gap-2"><i data-lucide="shield-check" class="h-3 w-3"></i> Payments are 100% secure and encrypted.</p>
                        </div>
                    </div>

                    <div class="p-5 border-t bg-slate-50">
                        <div class="flex justify-between items-center mb-4 text-sm">
                             <span class="text-slate-500">Payable Amount</span>
                             <span class="font-bold text-slate-900" id="pay-total">₹0</span>
                        </div>
                        <button onclick="processOrder()" class="w-full bg-green-600 text-white py-4 rounded-xl font-bold shadow-lg hover:bg-green-700 transition flex justify-center items-center gap-2">
                            <span id="pay-btn-text">Pay & Place Order</span>
                            <i data-lucide="check-circle" class="h-4 w-4"></i>
                        </button>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- AI Chat Widget (New) -->
    <div id="chat-widget" class="fixed bottom-6 right-6 z-50 flex flex-col items-end gap-3 font-sans w-full max-w-xs sm:max-w-none sm:w-auto pointer-events-none">
        
        <!-- Chat Box (Hidden by default) -->
        <div id="chat-box" class="bg-white shadow-2xl rounded-2xl w-full sm:w-96 h-[500px] hidden flex-col border border-slate-200 overflow-hidden transition-all duration-300 origin-bottom-right chat-box-mobile pointer-events-auto">
            <!-- Header -->
            <div class="bg-gradient-to-r from-mednow-blue to-mednow-teal p-4 text-white flex justify-between items-center">
                <div class="flex items-center gap-2">
                    <div class="bg-white/20 p-1.5 rounded-lg backdrop-blur-sm">
                        <i data-lucide="bot" class="h-5 w-5 text-white"></i>
                    </div>
                    <div>
                        <h4 class="font-bold text-sm">AI Pharmacist</h4>
                        <p class="text-[10px] text-blue-50 flex items-center gap-1"><span class="w-1.5 h-1.5 bg-green-400 rounded-full"></span> Online</p>
                    </div>
                </div>
                <div class="flex items-center gap-2">
                    <button onclick="changeApiKey()" class="hover:bg-white/10 p-1 rounded transition" title="Change API Key"><i data-lucide="key" class="h-4 w-4"></i></button>
                    <button onclick="toggleChat()" class="hover:bg-white/10 p-1 rounded transition"><i data-lucide="x" class="h-5 w-5"></i></button>
                </div>
            </div>

            <!-- Messages Area -->
            <div id="chat-messages" class="flex-1 p-4 overflow-y-auto bg-slate-50 flex flex-col">
                <div class="chat-message chat-bot">
                    Hello! 👋 I'm MedNow's AI Assistant. Tell me your symptoms, or type "Order Dolo" (or any medicine) to buy directly!
                </div>
            </div>

            <!-- Input Area -->
            <div class="p-3 bg-white border-t flex gap-2 items-center">
                <input type="text" id="chat-input" placeholder="Type symptoms or 'Order Dolo'..." class="flex-1 border border-slate-200 rounded-full px-4 py-2 text-sm focus:outline-none focus:border-mednow-blue focus:ring-1 focus:ring-mednow-blue transition" onkeypress="handleChatEnter(event)">
                <button onclick="sendMessage()" class="bg-mednow-blue text-white p-2 rounded-full hover:bg-mednow-dark transition shadow-md disabled:opacity-50 disabled:cursor-not-allowed flex-shrink-0" id="send-btn">
                    <i data-lucide="send" class="h-4 w-4 ml-0.5"></i>
                </button>
            </div>
        </div>

        <!-- Toggle Button -->
        <div class="pointer-events-auto w-full flex justify-end pr-6 pb-2 sm:pr-0 sm:pb-0">
            <button onclick="toggleChat()" class="bg-gradient-to-r from-mednow-blue to-mednow-teal text-white px-5 py-3 rounded-full shadow-lg hover:shadow-xl hover:scale-105 transition flex items-center gap-2 font-bold animate-bounce-slow">
                <i data-lucide="sparkles" class="h-5 w-5"></i>
                <span>Ask AI Pharmacist</span>
            </button>
        </div>
    </div>

    <script>
        // --- AUTHENTICATION LOGIC ---
        let isLoggedIn = false;

        function toggleLoginModal() {
            const modal = document.getElementById('login-modal');
            if(modal.classList.contains('hidden')) {
                modal.classList.remove('hidden');
                // Reset to login by default
                switchAuthMode('login');
            } else {
                modal.classList.add('hidden');
            }
        }

        function switchAuthMode(mode) {
            const tabLogin = document.getElementById('tab-login');
            const tabSignup = document.getElementById('tab-signup');
            const formLogin = document.getElementById('form-login');
            const formSignup = document.getElementById('form-signup');

            if (mode === 'login') {
                tabLogin.classList.add('border-b-2', 'border-mednow-blue', 'text-mednow-blue');
                tabLogin.classList.remove('text-slate-400');
                tabSignup.classList.remove('border-b-2', 'border-mednow-blue', 'text-mednow-blue');
                tabSignup.classList.add('text-slate-400');
                
                formLogin.classList.remove('hidden');
                formSignup.classList.add('hidden');
            } else {
                tabSignup.classList.add('border-b-2', 'border-mednow-blue', 'text-mednow-blue');
                tabSignup.classList.remove('text-slate-400');
                tabLogin.classList.remove('border-b-2', 'border-mednow-blue', 'text-mednow-blue');
                tabLogin.classList.add('text-slate-400');
                
                formSignup.classList.remove('hidden');
                formLogin.classList.add('hidden');
            }
        }

        function performLogin() {
            const btn = document.querySelector('#login-modal button.bg-mednow-blue');
            const originalText = btn.innerHTML;
            
            btn.innerHTML = `<div class="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></div>`;
            btn.disabled = true;

            // Simulate API call
            setTimeout(() => {
                isLoggedIn = true;
                btn.innerHTML = originalText;
                btn.disabled = false;
                toggleLoginModal();
                updateAuthUI();
                
                // Show Welcome Toast
                const toast = document.createElement('div');
                toast.className = 'fixed top-24 right-4 bg-green-600 text-white px-6 py-3 rounded-lg shadow-xl z-[100] animate-fade-in-up flex items-center gap-2';
                toast.innerHTML = `<i data-lucide="check-circle" class="h-5 w-5"></i> <span>Welcome back, John!</span>`;
                document.body.appendChild(toast);
                lucide.createIcons();
                setTimeout(() => toast.remove(), 3000);
            }, 1500);
        }

        function logout() {
            isLoggedIn = false;
            updateAuthUI();
        }

        function updateAuthUI() {
            const loginBtn = document.getElementById('login-nav-btn');
            const authUser = document.getElementById('auth-user');
            
            if (isLoggedIn) {
                loginBtn.classList.add('hidden');
                authUser.classList.remove('hidden');
                authUser.classList.add('flex');
            } else {
                loginBtn.classList.remove('hidden');
                authUser.classList.add('hidden');
                authUser.classList.remove('flex');
            }
        }

        // --- API KEY HANDLING ---
       // Put your Gemini API Key here ↓
let apiKey = "AIzaSyD43Is-jLIO-yVWBpNhTY0BaAe_jlHXo9s";


// LocalStorage key name (should NOT be API key name)
const STORAGE_KEY = "AIzaSyD43Is-jLIO-yVWBpNhTY0BaAe_jlHXo9s";


function checkApiKey() {
   const saved = localStorage.getItem(STORAGE_KEY);


   if (saved) {
       apiKey = saved;
       console.log("🔐 Gemini Key Loaded From Storage");
   } else {
       // Save default key automatically — no popup
       localStorage.setItem(STORAGE_KEY, apiKey);
       console.log("🔐 Default API Key Stored");
   }
}


// Change key manually when needed
function changeApiKey() {
   const newKey = prompt("AIzaSyD43Is-jLIO-yVWBpNhTY0BaAe_jlHXo9s", apiKey);
   if (newKey) {
       apiKey = newKey;
       localStorage.setItem(STORAGE_KEY, newKey);
       alert("API Key Updated Successfully!");
   }
}


checkApiKey();  // No popup — just loads key
lucide.createIcons();




      // --- VIRTUAL IMAGE FOLDER (ASSETS) ---
      // Updated with new, reliable links + added fallbacks in the render function
      // const assets = {
      //     pills: "https://images.unsplash.com/photo-1584308666744-24d5c474f2ae?auto=format&fit=crop&w=400&q=80",
      //     syrup: "https://images.unsplash.com/photo-1624454002302-36b824d7bd0a?auto=format&fit=crop&w=400&q=80",
      //     cream: "https://images.unsplash.com/photo-1556228720-19de752802b7?auto=format&fit=crop&w=400&q=80",
      //     spray: "https://images.unsplash.com/photo-1631549916768-4119b2e5f926?auto=format&fit=crop&w=400&q=80",
      //     supplements: "https://images.unsplash.com/photo-1577401239170-897942555fb3?auto=format&fit=crop&w=400&q=80",
      //     glucometer: "https://images.unsplash.com/photo-1579684385127-1ef15d508118?auto=format&fit=crop&w=400&q=80",
      //     firstaid: "https://images.unsplash.com/photo-1603398938378-e54eab446dde?auto=format&fit=crop&w=400&q=80",
      //     thermometer: "https://images.unsplash.com/photo-1584036561566-b93a446db338?auto=format&fit=crop&w=400&q=80"
      // };




      //pain relief
      const assets = {
  dolo: "images/pain relief/Dolo-650mg.webp",
  crocin: "images/pain relief/crocin-advance.webp",
  volini: "images/pain relief/volini-spray.webp",
  moov: "images/pain relief/moov-ointment.webp",
  combiflam: "images/pain relief/combiflam.webp",
  ibuprofen: "images/pain relief/ibuprofen.webp",
  omnigel: "images/pain relief/omnigel.webp",
  amrutanjan: "images/pain relief/amrutanjan-balm.webp",
  disprin: "images/pain relief/disprin.webp",
  tigerbalm: "images/pain relief/tiger-balm.webp",








// --- Vitamins Images ---
  limcee: "images/vitamins/limcee-vit-c.webp",
  becosules: "images/vitamins/becosules-z.webp",
  zincovit: "images/vitamins/zincovit.webp",
  sevenseas: "images/vitamins/omega3.webp",
  neurobion: "images/vitamins/neurobian forte.webp",
  evion: "images/vitamins/evion.webp",
  revital: "images/vitamins/revital H.webp",
  shelcal: "images/vitamins/sheical 500.webp",




  // --- Diabetes Images ---




  accuchek: "images/Diabetes care/accu-chek-12-min.png",
  accustrips: "images/Diabetes care/accuatriostrip.jpeg",
  sugarfree: "images/Diabetes care/sugarfree.png",
  syringes: "images/Diabetes care/insulin-syringe.jpg",
  karela: "images/Diabetes care/karela.png",
  onetouch: "images/Diabetes care/onetouch.jpg",
  footcream: "images/Diabetes care/foot-cream.png",
  stevia: "images/Diabetes care/stevia.jpg",
// --- First Aid Images ---
  dettol: "images/first aid/dettol.webp",
  bandaid: "images/first aid/band-aid.jpeg",
  cotton: "images/first aid/cotton-roll.jpg",
  betadine: "images/first aid/betadine.jpeg",
  thermometer: "images/first aid/thermometer.jpeg",
  savlon: "images/first aid/savalon.jpeg",
  bandage: "images/first aid/crepebandage.webp",
  burnol: "images/first aid/burnol.jpeg"




};












      const products = [
          // --- PAIN RELIEF ---
          { name: "Dolo 650mg", cat: "pain", price: 30, img: assets.dolo, desc: "Strip of 15 Tablets" },
          { name: "Crocin Advance", cat: "pain", price: 25, img: assets.crocin, desc: "Strip of 20 Tablets" },
          { name: "Volini Spray", cat: "pain", price: 180, img: assets.volini, desc: "40g Pain Relief Spray" },
          { name: "Moov Ointment", cat: "pain", price: 140, img: assets.moov, desc: "50g Rapid Relief" },
          { name: "Combiflam", cat: "pain", price: 45, img: assets.combiflam, desc: "Strip of 20 Tablets" },
          { name: "Ibuprofen 400", cat: "pain", price: 22, img: assets.ibuprofen, desc: "Strip of 10 Tablets" },
          { name: "Omnigel", cat: "pain", price: 95, img: assets.omnigel, desc: "30g Pain Relief Gel" },
          { name: "Amrutanjan Balm", cat: "pain", price: 60, img: assets.amrutanjan, desc: "Small Jar" },
          { name: "Disprin", cat: "pain", price: 12, img: assets.disprin, desc: "Strip of 10 Effervescent" },
          { name: "Tiger Balm", cat: "pain", price: 85, img: assets.tigerbalm, desc: "Red Extra Strength" },
        
          // --- VITAMINS ---
          { name: "Limcee Vit C", cat: "vitamins", price: 25, img: assets.limcee, desc: "Chewable 15 Tabs" },
          { name: "Becosules Z", cat: "vitamins", price: 55, img: assets.becosules, desc: "Strip of 20 Caps" },
          { name: "Zincovit", cat: "vitamins", price: 110, img: assets.zincovit, desc: "Multivitamin Strip" },
          { name: "Seven Seas Omega", cat: "vitamins", price: 350, img: assets.sevenseas, desc: "Cod Liver Oil Bottle" },
          { name: "Neurobion Forte", cat: "vitamins", price: 40, img: assets.neurobion, desc: "B12 Support Strip" },
          { name: "Evion 400", cat: "vitamins", price: 38, img: assets.evion, desc: "Vitamin E Pearls" },
          { name: "Revital H", cat: "vitamins", price: 550, img: assets.revital, desc: "Daily Health Supplement" },
          { name: "Shelcal 500", cat: "vitamins", price: 120, img: assets.shelcal, desc: "Calcium + Vit D3" },
        
          // --- DIABETES CARE ---
          { name: "Accu-Chek Active", cat: "diabetes", price: 850, img: assets.accuchek, desc: "Glucometer Kit" },
          { name: "Accu-Chek Strips", cat: "diabetes", price: 950, img: assets.accustrips, desc: "Box of 50 Strips" },
          { name: "Sugar Free Gold", cat: "diabetes", price: 250, img: assets.sugarfree, desc: "500 Pellets" },
          { name: "Insulin Syringes", cat: "diabetes", price: 150, img: assets.syringes, desc: "Pack of 10 (40IU)" },
          { name: "Karela Jamun Juice", cat: "diabetes", price: 320, img: assets.karela, desc: "1 Litre Bottle" },
          { name: "OneTouch Select", cat: "diabetes", price: 1200, img: assets.onetouch, desc: "Simple Glucometer" },
          { name: "Foot Cream", cat: "diabetes", price: 280, img: assets.footcream, desc: "Diabetic Foot Care" },
          { name: "Stevia Drops", cat: "diabetes", price: 180, img: assets.stevia, desc: "Natural Sweetener" },
        
          // --- FIRST AID ---
          { name: "Dettol Liquid", cat: "first_aid", price: 120, img: assets.dettol, desc: "250ml Antiseptic" },
          { name: "Band-Aid", cat: "first_aid", price: 50, img: assets.bandaid, desc: "Washproof Box of 20" },
          { name: "Cotton Roll", cat: "first_aid", price: 60, img: assets.cotton, desc: "50g Absorbent" },
          { name: "Betadine Ointment", cat: "first_aid", price: 85, img: assets.betadine, desc: "20g Tube" },
          { name: "Digital Thermometer", cat: "first_aid", price: 250, img: assets.thermometer, desc: "Fast Reading" },
          { name: "Savlon Liquid", cat: "first_aid", price: 110, img: assets.savlon, desc: "250ml Bottle" },
          { name: "Crepe Bandage", cat: "first_aid", price: 150, img: assets.bandage, desc: "6cm x 4m" },
          { name: "Burnol Cream", cat: "first_aid", price: 70, img: assets.burnol, desc: "For Burns 20g" }
      ];







        // Assign IDs efficiently
        products.forEach((p, i) => p.id = i);

        // --- CART STATE ---
        let cart = [];
        let uploadedRxFile = null;
        
        // --- CHAT STATE FOR ORDERING ---
        let chatState = 'IDLE'; 
        let currentOrderProduct = null;
        let orderDetails = { address: "", phone: "" };

        // --- RENDER LOGIC ---
        const grid = document.getElementById('products-grid');
        const noResults = document.getElementById('no-results');
        const searchInput = document.getElementById('hero-search');

        function renderProducts(items) {
            grid.innerHTML = '';
            if (items.length === 0) {
                grid.classList.add('hidden');
                noResults.classList.remove('hidden');
                return;
            }
            
            grid.classList.remove('hidden');
            noResults.classList.add('hidden');

            items.forEach(product => {
                const card = document.createElement('div');
                card.className = 'bg-white p-3 md:p-4 rounded-xl shadow-sm border border-slate-100 hover:shadow-card transition group fade-in';
                
                // Added onerror to image tag
                card.innerHTML = `
                    <div class="h-28 md:h-36 w-full bg-slate-50 rounded-lg mb-3 relative overflow-hidden flex items-center justify-center">
                        <img src="${product.img}" 
                             alt="${product.name}" 
                             class="w-full h-full object-cover transition duration-500 group-hover:scale-105"
                             onerror="this.onerror=null; this.src='https://placehold.co/400x300/E1F5FE/0288D1?text=Medicine'; this.classList.add('object-contain', 'p-4');"
                        >
                        <div class="absolute bottom-0 left-0 w-full bg-gradient-to-t from-black/50 to-transparent p-2 opacity-0 group-hover:opacity-100 transition">
                            <p class="text-white text-[10px] md:text-xs font-medium">Instant Delivery</p>
                        </div>
                    </div>
                    <div class="flex justify-between items-start">
                        <div>
                            <h4 class="font-bold text-slate-800 text-xs md:text-sm truncate w-24 md:w-32">${product.name}</h4>
                            <p class="text-[10px] md:text-xs text-slate-500">${product.desc}</p>
                        </div>
                        <span class="font-bold text-mednow-blue text-sm md:text-base">₹${product.price}</span>
                    </div>
                    <button onclick="addToCart(${product.id})" class="w-full mt-3 py-2 rounded-lg bg-blue-50 text-mednow-blue text-xs md:text-sm font-bold hover:bg-mednow-blue hover:text-white transition flex items-center justify-center gap-2 active:scale-95">
                        Add <i data-lucide="plus" class="h-3 w-3"></i>
                    </button>
                `;
                grid.appendChild(card);
            });
            lucide.createIcons();
        }

        // Initial Render
        renderProducts(products);

        // --- SEARCH & FILTER LOGIC ---
        function filterCategory(category) {
            document.querySelectorAll('.category-btn').forEach(btn => {
                if(btn.dataset.cat === category) {
                    btn.classList.add('bg-mednow-blue', 'text-white', 'shadow-md');
                    btn.classList.remove('bg-white', 'text-slate-600', 'border');
                } else {
                    btn.classList.remove('bg-mednow-blue', 'text-white', 'shadow-md');
                    btn.classList.add('bg-white', 'text-slate-600', 'border');
                }
            });

            if (category === 'all') {
                renderProducts(products);
            } else {
                renderProducts(products.filter(p => p.cat === category));
            }
            searchInput.value = '';
            document.getElementById('active-filter-display').classList.add('hidden');
        }

        searchInput.addEventListener('input', (e) => {
            const term = e.target.value.toLowerCase();
            const filterDisplay = document.getElementById('active-filter-display');
            
            if(term.length > 0) {
                const filtered = products.filter(p => 
                    p.name.toLowerCase().includes(term) || 
                    p.cat.toLowerCase().includes(term)
                );
                renderProducts(filtered);
                
                document.querySelectorAll('.category-btn').forEach(btn => {
                    btn.classList.remove('bg-mednow-blue', 'text-white');
                    btn.classList.add('bg-white', 'text-slate-600');
                });

                filterDisplay.classList.remove('hidden');
                document.getElementById('filter-term').innerText = e.target.value;
            } else {
                renderProducts(products);
                filterDisplay.classList.add('hidden');
                filterCategory('all'); 
            }
        });

        function scrollToStore() {
            document.getElementById('otc').scrollIntoView({behavior: 'smooth'});
        }

        // --- CART LOGIC ---
        function toggleCart() {
            const modal = document.getElementById('cart-modal');
            const panel = document.getElementById('cart-panel');
            const backdrop = document.getElementById('cart-backdrop');

            if (modal.classList.contains('hidden')) {
                modal.classList.remove('hidden');
                setTimeout(() => {
                    backdrop.classList.remove('opacity-0');
                    panel.classList.remove('translate-x-full');
                }, 10);
                renderCart();
            } else {
                backdrop.classList.add('opacity-0');
                panel.classList.add('translate-x-full');
                setTimeout(() => {
                    modal.classList.add('hidden');
                    hidePayment(); 
                }, 300);
            }
        }

        function addToCart(id) {
            const product = products.find(p => p.id === id);
            cart.push(product);
            updateCartCount();
            
            const modal = document.getElementById('cart-modal');
            if (!modal.classList.contains('hidden')) {
                renderCart();
            }

            const badge = document.getElementById('cart-count');
            badge.parentElement.classList.add('scale-110');
            setTimeout(() => badge.parentElement.classList.remove('scale-110'), 200);
        }

        function bookLabTest(name, price) {
            cart.push({
                name: name,
                desc: "Lab Test - Home Collection",
                price: price,
                img: "https://images.unsplash.com/photo-1579165466741-7f35a4755657?auto=format&fit=crop&w=100&q=80"
            });
            updateCartCount();
            toggleCart(); 
        }

        function removeFromCart(index) {
            cart.splice(index, 1);
            updateCartCount();
            renderCart();
        }

        function updateCartCount() {
            const badge = document.getElementById('cart-count');
            badge.innerText = cart.length;
            if(cart.length > 0) {
                badge.classList.remove('scale-0');
                badge.classList.add('scale-100');
            } else {
                badge.classList.remove('scale-100');
                badge.classList.add('scale-0');
            }
        }

        function renderCart() {
            const container = document.getElementById('cart-items-container');
            const totalEl = document.getElementById('cart-total');
            const checkoutBtn = document.getElementById('checkout-btn');
            const payTotal = document.getElementById('pay-total');

            if (cart.length === 0) {
                container.innerHTML = `
                    <div class="flex flex-col items-center justify-center h-full text-slate-400 mt-20">
                        <i data-lucide="shopping-basket" class="h-16 w-16 mb-4 opacity-50"></i>
                        <p>Your cart is empty</p>
                        <button onclick="toggleCart(); scrollToStore()" class="mt-4 text-mednow-blue font-bold hover:underline">Start Shopping</button>
                    </div>
                `;
                totalEl.innerText = '₹0';
                payTotal.innerText = '₹0';
                checkoutBtn.disabled = true;
            } else {
                let total = 0;
                let html = '';
                cart.forEach((item, index) => {
                    total += item.price;
                    html += `
                        <div class="flex items-center gap-4 bg-slate-50 p-3 rounded-xl">
                            <div class="h-12 w-12 bg-white rounded-lg overflow-hidden border border-slate-200 flex-shrink-0">
                                <img src="${item.img}" class="w-full h-full object-cover">
                            </div>
                            <div class="flex-1">
                                <h5 class="font-bold text-slate-800 text-sm">${item.name}</h5>
                                <p class="text-xs text-slate-500">${item.desc}</p>
                            </div>
                            <div class="text-right">
                                <div class="font-bold text-slate-900">₹${item.price}</div>
                                <button onclick="removeFromCart(${index})" class="text-xs text-red-500 hover:underline">Remove</button>
                            </div>
                        </div>
                    `;
                });
                container.innerHTML = html;
                totalEl.innerText = '₹' + total;
                payTotal.innerText = '₹' + total;
                checkoutBtn.disabled = false;
            }
            lucide.createIcons();
        }

        function showPayment() {
            document.getElementById('payment-view').classList.remove('translate-x-full');
        }

        function hidePayment() {
            document.getElementById('payment-view').classList.add('translate-x-full');
        }

        function processOrder() {
            const btn = document.querySelector('button[onclick="processOrder()"]');
            const originalText = btn.innerHTML;
            
            btn.innerHTML = `<div class="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></div> Processing...`;
            btn.disabled = true;

            setTimeout(() => {
                btn.innerHTML = `<i data-lucide="check" class="h-5 w-5"></i> Order Placed!`;
                btn.classList.remove('bg-green-600');
                btn.classList.add('bg-mednow-blue');
                
                setTimeout(() => {
                    cart = [];
                    updateCartCount();
                    toggleCart();
                    setTimeout(() => {
                        btn.disabled = false;
                        btn.innerHTML = originalText;
                        btn.classList.add('bg-green-600');
                        btn.classList.remove('bg-mednow-blue');
                    }, 500);
                    alert("Order placed successfully! A pharmacist will verify and dispatch your order shortly.");
                }, 1000);
            }, 2000);
        }

        // --- UPLOAD / PRESCRIPTION LOGIC ---
        
        const fileInput = document.getElementById('file-input');
        
        fileInput.addEventListener('change', function() {
            if (this.files && this.files[0]) {
                uploadedRxFile = this.files[0];
                document.getElementById('rx-error').classList.add('hidden');
                
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('preview-image').src = e.target.result;
                    document.getElementById('preview-btn').classList.remove('hidden');
                }
                reader.readAsDataURL(uploadedRxFile);
                triggerUploadAnimation();
            }
        });

        function triggerUploadAnimation() {
            const def = document.getElementById('upload-default');
            const load = document.getElementById('upload-loading');
            const succ = document.getElementById('upload-success');
            
            load.classList.remove('hidden');
            setTimeout(() => {
                load.classList.add('hidden');
                succ.classList.remove('hidden');
                setTimeout(() => {
                    succ.classList.add('hidden');
                    def.innerHTML = `
                        <div class="bg-green-50 p-3 rounded-full shadow-sm mb-3 inline-block">
                            <i data-lucide="check" class="h-8 w-8 text-green-600"></i>
                        </div>
                        <p class="font-bold text-slate-800">File Selected</p>
                        <p class="text-xs text-green-600 mt-1">Ready to submit</p>
                    `;
                    lucide.createIcons();
                }, 2000);
            }, 1500);
        }

        function submitPrescription() {
            if (!uploadedRxFile) {
                const err = document.getElementById('rx-error');
                err.classList.remove('hidden');
                err.classList.add('animate-shake');
                setTimeout(() => err.classList.remove('animate-shake'), 500);
                return;
            }
            const btn = document.getElementById('submit-rx-btn');
            const originalText = btn.innerHTML;
            btn.innerHTML = `<div class="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></div> Sending...`;
            btn.disabled = true;
            setTimeout(() => {
                btn.innerHTML = `<i data-lucide="check-circle" class="h-5 w-5"></i> Sent Successfully!`;
                btn.classList.remove('from-mednow-blue', 'to-mednow-teal');
                btn.classList.add('bg-green-600');
                alert("Prescription Sent! A pharmacist will call you shortly to confirm the medicines.");
                setTimeout(() => {
                   btn.disabled = false;
                   btn.innerHTML = originalText;
                   btn.classList.add('from-mednow-blue', 'to-mednow-teal');
                   btn.classList.remove('bg-green-600');
                }, 3000);
            }, 2000);
        }

        // --- AI FEATURES IMPLEMENTATION ---

        // 1. Chat Logic
        function toggleChat() {
            const box = document.getElementById('chat-box');
            if (box.classList.contains('hidden')) {
                box.classList.remove('hidden');
                box.classList.add('flex');
            } else {
                box.classList.add('hidden');
                box.classList.remove('flex');
            }
        }

        async function callGeminiText(userText) {
            if (!navigator.onLine) {
                return "I am currently offline. Please check your internet connection.";
            }

            const inventory = products.map(p => p.name).join(", ");
            const systemPrompt = `You are a friendly AI Pharmacist for MedNow. 
            The user will describe symptoms. You must suggest medicines specifically from our inventory: [${inventory}]. 
            If we don't have a specific medicine, suggest a general category we might have (like Pain Relief or Vitamins).
            Keep responses short (under 50 words). 
            ALWAYS end with a short disclaimer: "Consult a doctor for serious conditions."`;
            
            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: userText }] }],
                        systemInstruction: { parts: [{ text: systemPrompt }] }
                    })
                });
                
                if (!response.ok) throw new Error('API Error');
                const data = await response.json();
                return data.candidates[0].content.parts[0].text;
            } catch (error) {
                console.error(error);
                return "I'm having trouble connecting to the pharmacy server. Please check your API key using the key icon above.";
            }
        }

        function handleChatEnter(e) {
            if (e.key === 'Enter') sendMessage();
        }

        async function sendMessage() {
            const input = document.getElementById('chat-input');
            const text = input.value.trim();
            if (!text) return;

            const container = document.getElementById('chat-messages');
            
            // Add User Message
            container.innerHTML += `<div class="chat-message chat-user">${text}</div>`;
            input.value = '';
            container.scrollTop = container.scrollHeight;

            // --- CHAT ORDER STATE MACHINE ---
            // 1. State: IDLE -> Check if user wants to buy/order
            if (chatState === 'IDLE') {
                if (text.toLowerCase().includes('buy') || text.toLowerCase().includes('order')) {
                    // Extract product name simplistically (everything after 'buy' or 'order')
                    let product = text.replace(/buy|order/i, '').trim();
                    if(product.length < 2) product = "medicine"; // fallback
                    
                    currentOrderProduct = product;
                    chatState = 'AWAITING_ADDRESS';
                    
                    setTimeout(() => {
                         container.innerHTML += `<div class="chat-message chat-bot">I can help you order <b>${product}</b> instantly. 📦<br>Please enter your <b>Delivery Address</b>:</div>`;
                         container.scrollTop = container.scrollHeight;
                    }, 500);
                    return;
                }
            }
            
            // 2. State: AWAITING_ADDRESS -> Get Address, Ask for Phone
            else if (chatState === 'AWAITING_ADDRESS') {
                orderDetails.address = text;
                chatState = 'AWAITING_PHONE';
                
                setTimeout(() => {
                     container.innerHTML += `<div class="chat-message chat-bot">Got it. 📍<br>Now, please enter your <b>Mobile Number</b>:</div>`;
                     container.scrollTop = container.scrollHeight;
                }, 500);
                return;
            }

            // 3. State: AWAITING_PHONE -> Confirm Order
            else if (chatState === 'AWAITING_PHONE') {
                orderDetails.phone = text;
                chatState = 'IDLE';
                
                setTimeout(() => {
                     container.innerHTML += `<div class="chat-message chat-bot">✅ <b>Order Placed!</b><br>Ordering: ${currentOrderProduct}<br>To: ${orderDetails.address}<br>Phone: ${orderDetails.phone}<br><br>A pharmacist will call you shortly to confirm.</div>`;
                     container.scrollTop = container.scrollHeight;
                }, 800);
                return;
            }

            // --- AI FALLBACK FOR SYMPTOMS ---
            
            // Smart Check: If no key is present, ask for it instantly
            if (!apiKey) {
                 const userKey = prompt("To chat with the AI Pharmacist, please enter your Gemini API Key:");
                 if(userKey) {
                     apiKey = userKey;
                     localStorage.setItem("gemini_api_key", userKey);
                 } else {
                     container.innerHTML += `<div class="chat-message chat-bot bg-red-50 text-red-600 border-red-100">⚠️ I need an API Key to function. Please click the Key icon above to set it.</div>`;
                     container.scrollTop = container.scrollHeight;
                     return;
                 }
            }

            // Add Typing Indicator
            const typingId = 'typing-' + Date.now();
            container.innerHTML += `
                <div class="chat-message chat-bot" id="${typingId}">
                    <div class="flex gap-1">
                        <span class="w-2 h-2 bg-slate-400 rounded-full typing-dot"></span>
                        <span class="w-2 h-2 bg-slate-400 rounded-full typing-dot"></span>
                        <span class="w-2 h-2 bg-slate-400 rounded-full typing-dot"></span>
                    </div>
                </div>`;
            container.scrollTop = container.scrollHeight;

            // Call API
            const reply = await callGeminiText(text);
            
            // Remove Typing & Add Bot Message
            document.getElementById(typingId).remove();
            const formattedReply = reply.replace(/\*\*(.*?)\*\*/g, '<b>$1</b>');
            container.innerHTML += `<div class="chat-message chat-bot">${formattedReply}</div>`;
            container.scrollTop = container.scrollHeight;
        }

        // 2. Vision Logic (Prescription Scan)
        async function analyzePrescription() {
            if (!uploadedRxFile) return;
            
            // Offline Check
            if (!navigator.onLine) {
                alert("You are offline. Please check your internet connection to use AI scanning.");
                return;
            }

            // Key Check
            if (!apiKey) {
                const userKey = prompt("Please enter your Gemini API key to scan:");
                if(userKey) {
                    apiKey = userKey;
                    localStorage.setItem("gemini_api_key", userKey);
                } else {
                    return;
                }
            }

            const btn = document.getElementById('ai-scan-btn');
            const resultsDiv = document.getElementById('ai-scan-results');
            
            const originalText = btn.innerHTML;
            btn.innerHTML = `<div class="w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"></div> Scanning...`;
            btn.disabled = true;

            // Convert file to base64
            const reader = new FileReader();
            reader.readAsDataURL(uploadedRxFile);
            reader.onloadend = async function() {
                const base64Data = reader.result.split(',')[1];
                
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{
                                parts: [
                                    { text: "Analyze this prescription image. List the medicine names found in a simple comma-separated list. If you cannot read it, say 'Handwriting unclear'." },
                                    { inlineData: { mimeType: uploadedRxFile.type, data: base64Data } }
                                ]
                            }]
                        })
                    });

                    const data = await response.json();
                    const text = data.candidates[0].content.parts[0].text;

                    resultsDiv.classList.remove('hidden');
                    resultsDiv.innerHTML = `<strong>✨ AI Detected Medicines:</strong><br>${text}`;
                } catch (error) {
                    console.error(error);
                    resultsDiv.classList.remove('hidden');
                    resultsDiv.innerHTML = `<span class="text-red-500">Could not analyze image. Check API Key.</span>`;
                } finally {
                    btn.innerHTML = originalText;
                    btn.disabled = false;
                }
            }
        }

        // Modal Toggles
        function toggleGuidelines() {
            const m = document.getElementById('guidelines-modal');
            m.classList.toggle('hidden');
        }

        function togglePreview() {
            const m = document.getElementById('preview-modal');
            m.classList.toggle('hidden');
            // Reset AI results when closing/opening
            document.getElementById('ai-scan-results').classList.add('hidden');
        }

        // --- UTILS ---
        window.addEventListener('scroll', function() {
            const navbar = document.getElementById('navbar');
            if (window.scrollY > 10) {
                navbar.classList.add('bg-white', 'shadow-md');
                navbar.classList.remove('bg-transparent');
            } else {
                navbar.classList.add('bg-white/90', 'backdrop-blur-sm');
                navbar.classList.remove('shadow-md');
            }
        });

        function toggleMobileMenu() {
            document.getElementById('mobile-menu').classList.toggle('hidden');
        }
        
        const locationBtn = document.getElementById('location-btn');
        locationBtn.addEventListener('click', function() {
            document.getElementById('location-text').innerText = "Locating...";
            setTimeout(() => {
                document.getElementById('location-text').innerText = "Mumbai, 400001";
                locationBtn.classList.add('bg-green-50', 'text-green-700');
            }, 1500);
        });
    </script>
</body>
</html>